# LSON

ヒューマン・リーダブルなデータ交換フォーマットである JSON (JavaScript
Object Notation) を使って表記する Lisp です。

JSON には以下のデータ型があります。

    Number      数値       1, 2, 3, ...
    String      文字列     "abc", ...
    Array       リスト     [1,2,3], ["a",2,["c"]]
    Object      辞書       {"a":1, "b":2}
    true        真
    false       偽
    null        ヌル

## 評価のルール

数値, true/false/null は、それ自身に評価されます。

    > 1
    1
    > true
    true

計算を行うには、関数を呼び出します。関数はリストを評価することで呼び出
せます。第一要素として、関数の名前を文字列で指定し、残りはその関数への
引数を指定します。

    > ["+", 1, 2]
    3
    > ["*", 3, ["+", 1, 2]]
    9

文字列は、評価するとその名前に対応付けられた値になります。

    > "x"
    Error: unbound name "x"
    > ["def", "x", 123]
    123
    > "x"
    123

"x" には始め、値が対応していないのでエラーになりましたが、"def" 形式で
値 123 を対応付けると、123 に評価されるようになりました。"def" 形式は、
グローバル変数を定義します。

"x" という文字列自体が欲しい場合は、"quote" 形式を使います。

    > ["quote", "x"]
    "x"

`["", "x"]` と書くこともできます。

    > ["", "x"]
    "x"

辞書は、評価すると名前/値ペアの値の部分が評価されます。

    > {"a": ["+", 1, 2]}
    {"a":3}

値を取り出すには、辞書を関数のようにリストの第一要素に指定し、引数とし
てキーを指定します。

    > [{"a":3}, ["","a"]]
    3

## ローカル変数

ローカル変数は "let" 形式を使って定義します。

    > ["let", ["x", 1], "x"]
    1
    > "x"
    Error: unbound name "x"

["x", 1] の部分でローカル変数 "x" を作成して値 1 を対応付けました。
"let" 形式全体は、最後の要素を評価した値になります。この場合は "x" な
ので、1 になります。

"let" 形式の外側では定義したローカル変数を使うことはできません。

変数名と値を交互に書く事で、複数の変数を一度に定義できます。

    > ["let", ["x", 1, "y", 2], ["+", "x", "y"]]
    3

## 関数の作成

関数は "fn" 形式を使って作成します。受け取った引数 "x" に 1 を足して返
す関数を作ってみます。

    > ["fn", ["x"], ["+", 1, "x"]]
    ["closure",["fn",["x"],["+",1,"x"]],[]]

なにやらリストが返りましたが、これをリストの第一引数にして呼び出すこと
ができます。

    > [["fn",["x"],["+",1,"x"]], 10]
    11

"defun" マクロを使って、グローバルな名前を付けて関数を定義することがで
きます。(`["def", "inc", ["fn", ["x"], ["+", 1, "x"]]]` としても同じこ
とができます)

    > ["defun", "inc", ["x"], ["+", 1, "x"]]
    "inc"
    > ["inc",30]
    31

グローバルな名前が付いていれば再帰呼び出しもできます。

    ["defun", "fact", ["n"], ["if", ["<=", "n", 0], 1, ["*", "n", ["fact", ["-","n",1]]]]]
    "fact"
    > ["fact",10]
    3628800

関数は、それが定義された位置でのローカル変数を利用することができます。

    > ["let", ["n", 10], ["defun", "plus-10", ["x"], ["+", "n", "x"]]]
    "plus-10"
    > ["plus-10", 3]
    13

## 可変長引数と分割代入

引数をリストとして受け取るには、仮引数の前に文字列 "&" を指定します。

    > ["defun", "f", ["first", "&", "rest"], ["list", "first", ["","AND"], "rest"]]
    "f"
    > ["f", 1, 2, 3, 4]
    [1,"AND",[2,3,4]]

仮引数として名前のリストを指定すると、対応する実引数がリストだった場合
に、それぞれの要素が対応する名前に対応付けられます。

    ["defun", "g", [["x","y"], "z"], ["list","z","y","x"]]
    "g"
    > ["g", ["",[1,2]], 3]
    [3,2,1]

## マクロ

"defmacro" で、マクロを定義することができます。

    > ["defmacro", "unless", ["test","&","body"], ["list", ["","if"], ["list",["","not"],"test"], ["append", ["",["do"]], "body"]]]
    "unless"
    > ["unless", false, ["p", ["","test is false"]], 1]
    "test is false"
    1
    > ["unless", true, ["p", ["","test is false"]], 1]
    null
